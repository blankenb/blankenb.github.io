(this["webpackJsonpdiamond-hands"]=this["webpackJsonpdiamond-hands"]||[]).push([[0],{16:function(t,e,s){},23:function(t,e,s){},24:function(t,e,s){},26:function(t,e,s){"use strict";s.r(e);var a=s(1),l=s.n(a),n=s(17),r=s.n(n),i=(s(23),s(3)),c=s(4),o=s(2),u=s(5),p=btoa("770776614bfc481db181a1506efb6b9a:065fd50712ca46d89b1744ecb28f613e"),h=s(18),y=(s(24),s(0)),d=function(t){Object(o.a)(s,t);var e=Object(u.a)(s);function s(t){var a;return Object(i.a)(this,s),(a=e.call(this,t)).handlePlaylist1Change=function(t){a.setState({playlist1Url:t.target.value,playlist1Error:null})},a.handlePlaylist2Change=function(t){a.setState({playlist2Url:t.target.value,playlist2Error:null})},a.enableSubmit=function(){return""!==a.state.playlist1Url&&""!==a.state.playlist2Url&&null===a.state.playlist1Error&&null==a.state.playlist2Error},a.handleSubmit=function(t){t.preventDefault(),console.log("handling submit"),a.setState({playlist1:null,playlist2:null}),a.fetchPlaylist(a.state.playlist1Url,"playlist1"),a.fetchPlaylist(a.state.playlist2Url,"playlist2")},a.state={playlist1Url:"",playlist2Url:"",playlist1Error:null,playlist2Error:null,playlist1:null,playlist2:null},a}return Object(c.a)(s,[{key:"fetchPlaylist",value:function(t,e){var s=this,a=Object(h.a)(/playlist\/([0-9A-Z_a-z]+)/,{playlist_id:1}),l=t.match(a);if(null===l){console.log("error parsing playlist");var n={};return n[e+"Error"]="Not a valid playlist URL",void this.setState(n)}console.log("id: "+l.groups.playlist_id);var r="https://api.spotify.com/v1/playlists/".concat(l.groups.playlist_id,"?fields=id%2Cname%2Cowner%2Cimages");this.props.refreshTokenIfNecessary(),fetch(r,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+this.props.accessToken}}).then((function(t){if(!t.ok)throw 404===t.status?new Error("404"):401===t.status?new Error("401"):new Error("400");return t.json()})).then((function(t){console.log(t);var a={};a[e]=t,s.setState(a),null!==s.state.playlist1&&null!==s.state.playlist2&&s.props.setPlaylists(s.state.playlist1,s.state.playlist2)})).catch((function(t){console.log(t);var a={};"404"===t.message?a[e+"Error"]="Playlist not found":"401"===t.message?a[e+"Error"]="Error connecting to Spotify. Please reload the page and try again.":a[e+"Error"]="Unknown error occurred",s.setState(a)}))}},{key:"render",value:function(){return Object(y.jsxs)("div",{className:"splash-page",children:[Object(y.jsx)("h1",{children:"Welcome to Library Linker"}),Object(y.jsxs)("div",{className:"playlist-enter",children:[Object(y.jsx)("p",{children:"Enter the URLs of two Spotify playlists to check their similarity and discover recommendations"}),Object(y.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(y.jsxs)("div",{className:"textbox-wrapper",children:[Object(y.jsx)("input",{type:"text",className:"textbox",value:this.state.playlist1Url,onChange:this.handlePlaylist1Change,placeholder:"Playlist URL"}),null!==this.state.playlist1Error&&Object(y.jsx)("span",{className:"error",children:this.state.playlist1Error})]}),Object(y.jsxs)("div",{className:"textbox-wrapper",children:[Object(y.jsx)("input",{type:"text",className:"textbox",value:this.state.playlist2Url,onChange:this.handlePlaylist2Change,placeholder:"Playlist URL"}),null!==this.state.playlist2Error&&Object(y.jsx)("span",{className:"error",children:this.state.playlist2Error})]}),this.enableSubmit()?Object(y.jsx)("button",{type:"submit",className:"pill",children:"Find Shared Tastes"}):Object(y.jsx)("button",{disabled:!0,type:"submit",className:"pill",children:"Find Shared Tastes"})]})]})]})}}]),s}(l.a.Component),m=s(7),g=s(6),f=(s(16),function(t){Object(o.a)(s,t);var e=Object(u.a)(s);function s(t){var a;return Object(i.a)(this,s),(a=e.call(this,t)).resetPlaylist=function(){a.props.setPlaylists(null,null)},a}return Object(c.a)(s,[{key:"render",value:function(){return Object(y.jsx)("div",{className:"sidebar",children:Object(y.jsxs)("div",{className:"top",children:[Object(y.jsx)("h1",{children:"Library Linker"}),Object(y.jsxs)("div",{className:"playlists",children:[Object(y.jsxs)("div",{className:"playlists-header",children:[Object(y.jsx)("h2",{children:"Playlists"}),Object(y.jsx)("button",{className:"text",onClick:this.resetPlaylist,children:"Change"})]}),Object(y.jsxs)("div",{className:"playlist",children:[Object(y.jsx)("div",{className:"playlist-name",children:this.props.playlist1.name}),Object(y.jsxs)("div",{className:"playlist-owner",children:["Created by ",Object(y.jsx)("b",{children:this.props.playlist1.owner.display_name})]})]}),Object(y.jsxs)("div",{className:"playlist",children:[Object(y.jsx)("div",{className:"playlist-name",children:this.props.playlist2.name}),Object(y.jsxs)("div",{className:"playlist-owner",children:["Created by ",Object(y.jsx)("b",{children:this.props.playlist2.owner.display_name})]})]})]})]})})}}]),s}(l.a.Component)),j=function(t){Object(o.a)(s,t);var e=Object(u.a)(s);function s(t){var a;return Object(i.a)(this,s),(a=e.call(this,t)).selectShared=function(){"shared"!==a.state.menuSelected&&a.setState({menuSelected:"shared"})},a.selectPlaylist1Recommended=function(){"p1"!==a.state.menuSelected&&a.setState({menuSelected:"p1"})},a.selectPlaylist2Recommended=function(){"p2"!==a.state.menuSelected&&a.setState({menuSelected:"p2"})},a.getBrightness=function(t,e,s){return(299*t+587*e+114*s)/1e3},a.getRandomColorStyling=function(){var t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),s=Math.floor(256*Math.random()),l=a.getBrightness(t,e,s);return{backgroundColor:"rgb(".concat(t,", ").concat(e,", ").concat(s,")"),color:l>=128?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)"}},a.getSource=function(){"p1"!==a.state.menuSelected||a.state.menuSelected},a.state={menuSelected:"shared"},a}return Object(c.a)(s,[{key:"render",value:function(){var t=this,e=this.props.simularityScore,s=this.props.sources[this.state.menuSelected].genres,a=this.props.sources[this.state.menuSelected].artists,l=this.props.sources[this.state.menuSelected].songs;return Object(y.jsxs)("div",{className:"stats-wrapper",children:[Object(y.jsx)("section",{id:"similarity",children:Object(y.jsxs)("h1",{className:"statistic-name",children:["Similarity:\xa0",Object(y.jsxs)("span",{className:"statistic-value",children:[e,"%"]})]})}),Object(y.jsxs)("section",{id:"menu",children:[Object(y.jsx)("button",{className:"menu ".concat("shared"===this.state.menuSelected?"selected":""),onClick:this.selectShared,children:"Shared"}),Object(y.jsxs)("button",{className:"menu ".concat("p1"===this.state.menuSelected?"selected":""),onClick:this.selectPlaylist1Recommended,children:["Recommended for ",this.props.playlist1.name]}),Object(y.jsxs)("button",{className:"menu ".concat("p2"===this.state.menuSelected?"selected":""),onClick:this.selectPlaylist2Recommended,children:["Recommended for ",this.props.playlist2.name]})]}),Object(y.jsxs)("section",{id:"genres",children:[Object(y.jsx)("h2",{className:"section-name",children:"Genres"}),0===s.length?Object(y.jsx)("div",{className:"no-values",children:"shared"===this.state.menuSelected?"No shared genres :(":"Playlist already shares all genres :)"}):Object(y.jsx)("ul",{className:"statistic-value",children:s.map((function(e,s){return Object(y.jsx)("li",{style:t.getRandomColorStyling(),children:e.name},s)}))})]}),Object(y.jsxs)("section",{id:"artists",children:[Object(y.jsx)("h2",{className:"section-name",children:"Artists"}),0===a.length?Object(y.jsx)("div",{className:"no-values",children:"shared"===this.state.menuSelected?"No shared artists :(":"Playlist already shares all artists :)"}):Object(y.jsx)("ul",{className:"statistic-value",children:a.map((function(t,e){return Object(y.jsx)("li",{style:{backgroundImage:"linear-gradient(0deg, rgba(0,0,0,0.2), rgba(0,0,0,0.2)), url(".concat(t.imageUrl,")")},children:Object(y.jsx)("a",{href:t.url,target:"_blank",className:"artist-link",children:Object(y.jsx)("div",{className:"artist-name-wrapper",children:Object(y.jsx)("div",{className:"artist-name",children:t.name})})})},e)}))})]}),Object(y.jsxs)("section",{id:"songs",children:[Object(y.jsx)("h2",{className:"section-name",children:"Songs"}),0===l.length?Object(y.jsx)("div",{className:"no-values",children:"shared"===this.state.menuSelected?"No shared songs :(":"Playlist already shares all songs :)"}):Object(y.jsx)("ul",{className:"statistic-value",children:l.map((function(t,e){var s=t.artistNames.join(", ");return Object(y.jsx)("li",{children:Object(y.jsx)("a",{href:t.url,target:"_blank",children:Object(y.jsxs)("div",{className:"song-wrapper",children:[Object(y.jsx)("div",{className:"song-image",style:{backgroundImage:"url(".concat(t.imageUrl,")")}}),Object(y.jsx)("div",{className:"song-name",children:t.name}),Object(y.jsx)("div",{className:"artist-names",children:s})]})})},e)}))})]})]})}}]),s}(l.a.Component),b=function(t){Object(o.a)(s,t);var e=Object(u.a)(s);function s(t){var a;Object(i.a)(this,s),(a=e.call(this,t)).fetchPlaylistTracks=function(t,e,s){if(null===s&&(console.log("Building new updateobject for "+t+" "+e),(s={})[t]=a.state[t],s[e]=a.state[e]),null===s[t])return console.log("FETCHING no more playlists for "+t+" "+e),a.setState(s),void a.formatData(e);console.log("FETCHING playlists for "+t+" "+e),console.log(s),a.props.refreshTokenIfNecessary(),fetch(s[t],{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.props.accessToken}}).then((function(t){return t.json()})).then((function(l){s[t]=l.next,s[e].items=s[e].items.concat(l.items),a.fetchPlaylistTracks(t,e,s)})).catch((function(t){console.log(t)}))},a.getSmallImageUrl=function(t){if(!t||0===t.length)return"";var e,s={height:999999},a=Object(g.a)(t);try{for(a.s();!(e=a.n()).done;){var l=e.value;l.height<s.height&&(s=l)}}catch(n){a.e(n)}finally{a.f()}return s.url},a.getMediumImageUrl=function(t){if(!t||0===t.length)return"";var e,s=Object(g.a)(t);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(a.height>=200&&a.height<=400)return a.url}}catch(l){s.e(l)}finally{s.f()}return t[t.length-1].url},a.formatData=function(t){var e={};e[t]=a.state[t],console.log("Setting songs for "+t);var s,l={},n=Object(g.a)(a.state[t].items);try{for(n.s();!(s=n.n()).done;){var r=s.value;l.hasOwnProperty(r.track.id)||(l[r.track.id]={name:r.track.name,artistNames:r.track.artists.map((function(t){return t.name})),url:r.track.external_urls.spotify,imageUrl:a.getSmallImageUrl(r.track.album.images)})}}catch(d){n.e(d)}finally{n.f()}e[t].songs=l,e[t].songSet=new Set(Object.keys(l)),console.log("Setting artists for "+t);var i,c={},o=Object(g.a)(a.state[t].items);try{for(o.s();!(i=o.n()).done;){var u,p=i.value,h=Object(g.a)(p.track.artists);try{for(h.s();!(u=h.n()).done;){var y=u.value;c.hasOwnProperty(y.id)?c[y.id].count+=1:c[y.id]={name:y.name,url:y.external_urls.spotify,imageUrl:"",count:1}}}catch(d){h.e(d)}finally{h.f()}}}catch(d){o.e(d)}finally{o.f()}e[t].artists=c,e[t].artistSet=new Set(Object.keys(c)),a.formatExtraData(t,e,Object.keys(c).slice(0))},a.formatExtraData=function(t,e,s){if(0===s.length)return console.log("Finished collecting extra data for "+t),a.setState(e),console.log(a.state),void a.setSources();console.log("Setting genres for "+t);var l={},n=s.slice(0,50).join("%2C");s=s.slice(50),a.props.refreshTokenIfNecessary(),fetch("https://api.spotify.com/v1/artists?ids=".concat(n),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a.props.accessToken}}).then((function(t){return t.json()})).then((function(n){console.log(n);var r,i=Object(g.a)(n.artists);try{for(i.s();!(r=i.n()).done;){var c=r.value;if(c){var o,u=Object(g.a)(c.genres);try{for(u.s();!(o=u.n()).done;){var p=o.value;l.hasOwnProperty(p)?l[p]+=1:l[p]=1}}catch(h){u.e(h)}finally{u.f()}e[t].artists[c.id].imageUrl=a.getMediumImageUrl(c.images)}}}catch(h){i.e(h)}finally{i.f()}e[t].genres=l,e[t].genreSet=new Set(Object.keys(l)),a.formatExtraData(t,e,s)})).catch((function(t){console.log(t)}))},a.getGenreIntersection=function(){return null===a.state.playlist1Data.genreSet||null===a.state.playlist2Data.genreSet?[]:Array.from(new Set(Object(m.a)(a.state.playlist1Data.genreSet).filter((function(t){return a.state.playlist2Data.genreSet.has(t)})))).sort((function(t,e){var s=a.state.playlist1Data.genres[t]+a.state.playlist2Data.genres[t];isNaN(s)&&(s=0);var l=a.state.playlist1Data.genres[e]+a.state.playlist2Data.genres[e];return isNaN(l)&&(l=0),l-s})).map((function(t){return{name:t,playlist1DataCount:a.state.playlist1Data.genres[t],playlist2DataCount:a.state.playlist2Data.genres[t]}}))},a.getArtistIntersection=function(){return null===a.state.playlist1Data.artistSet||null===a.state.playlist2Data.artistSet?[]:Array.from(new Set(Object(m.a)(a.state.playlist1Data.artistSet).filter((function(t){return a.state.playlist2Data.artistSet.has(t)})))).sort((function(t,e){var s=a.state.playlist1Data.artists[t].count+a.state.playlist2Data.artists[t].count;isNaN(s)&&(s=0);var l=a.state.playlist1Data.artists[e].count+a.state.playlist2Data.artists[e].count;return isNaN(l)&&(l=0),l-s})).map((function(t){return{name:a.state.playlist1Data.artists[t].name,url:a.state.playlist1Data.artists[t].url,imageUrl:a.state.playlist1Data.artists[t].imageUrl,playlist1DataCount:a.state.playlist1Data.artists[t].count,playlist2DataCount:a.state.playlist2Data.artists[t].count}}))},a.getSongIntersection=function(){return null===a.state.playlist1Data.songSet||null===a.state.playlist2Data.songSet?[]:Array.from(new Set(Object(m.a)(a.state.playlist1Data.songSet).filter((function(t){return a.state.playlist2Data.songSet.has(t)})))).map((function(t){return a.state.playlist1Data.songs[t]}))},a.getGenreDifference=function(t,e){return null===a.state[t].genreSet||null===a.state[e].genreSet?[]:Array.from(new Set(Object(m.a)(a.state[t].genreSet).filter((function(t){return!a.state[e].genreSet.has(t)})))).sort((function(e,s){var l=a.state[t].genres[e];isNaN(l)&&(l=0);var n=a.state[t].genres[s];return isNaN(n)&&(n=0),n-l})).map((function(e){var s={name:e};return s[t+"Count"]=a.state[t].genres[e],s}))},a.getArtistDifference=function(t,e){return null===a.state[t].artistSet||null===a.state[e].artistSet?[]:Array.from(new Set(Object(m.a)(a.state[t].artistSet).filter((function(t){return!a.state[e].artistSet.has(t)})))).sort((function(e,s){var l=a.state[t].artists[e].count;isNaN(l)&&(l=0);var n=a.state[t].artists[s].count;return isNaN(n)&&(n=0),n-l})).map((function(e){var s={name:a.state[t].artists[e].name,url:a.state[t].artists[e].url,imageUrl:a.state[t].artists[e].imageUrl};return s[t+"Count"]=a.state[t].artists[e].count,s}))},a.getSongDifference=function(t,e){return null===a.state[t].songSet||null===a.state[e].songSet?[]:Array.from(new Set(Object(m.a)(a.state[t].songSet).filter((function(t){return!a.state[e].songSet.has(t)})))).map((function(e){return a.state[t].songs[e]}))},a.getSimilarityScore=function(){if(null===a.state.playlist1Data.genreSet||null===a.state.playlist1Data.artistSet||null===a.state.playlist2Data.genreSet||null===a.state.playlist2Data.artistSet)return 0;var t=a.state.sources.shared.genres.length/Math.min(a.state.playlist1Data.genreSet.size,a.state.playlist2Data.genreSet.size);return(80*(a.state.sources.shared.artists.length/Math.min(a.state.playlist1Data.artistSet.size,a.state.playlist2Data.artistSet.size))+20*t).toFixed(2)},a.setSources=function(){a.setState({sources:{shared:{genres:a.getGenreIntersection(),artists:a.getArtistIntersection(),songs:a.getSongIntersection()},p1:{genres:a.getGenreDifference("playlist2Data","playlist1Data"),artists:a.getArtistDifference("playlist2Data","playlist1Data"),songs:a.getSongDifference("playlist2Data","playlist1Data")},p2:{genres:a.getGenreDifference("playlist1Data","playlist2Data"),artists:a.getArtistDifference("playlist1Data","playlist2Data"),songs:a.getSongDifference("playlist1Data","playlist2Data")}}})},a.componentDidMount=function(){console.log("fetching playlists"),a.fetchPlaylistTracks("next1","playlist1Data",null),a.fetchPlaylistTracks("next2","playlist2Data",null)};var l=a.props,n=l.playlist1,r=l.playlist2;return a.state={next1:"https://api.spotify.com/v1/playlists/".concat(n.id,"/tracks?fields=next%2Citems(track(name%2Cid%2Cartists%2Cexternal_urls%2Cpreview_url%2Calbum(images)))&limit=100"),playlist1Data:{items:[],songs:{},artists:{},genres:{},songSet:null,artistSet:null,genreSet:null},next2:"https://api.spotify.com/v1/playlists/".concat(r.id,"/tracks?fields=next%2Citems(track(name%2Cid%2Cartists%2Cexternal_urls%2Cpreview_url%2Calbum(images)))&limit=100"),playlist2Data:{items:[],songs:{},artists:{},genres:{},songSet:null,artistSet:null,genreSet:null},sources:{shared:{genres:[],artists:[],songs:[]},p1:{genres:[],artists:[],songs:[]},p2:{genres:[],artists:[],songs:[]}}},a}return Object(c.a)(s,[{key:"render",value:function(){return Object(y.jsxs)("div",{className:"home-page",children:[Object(y.jsx)(f,{playlist1:this.props.playlist1,playlist2:this.props.playlist2,setPlaylists:this.props.setPlaylists}),Object(y.jsx)(j,{playlist1:this.props.playlist1,playlist2:this.props.playlist2,playlist1Data:this.state.playlist1Data,playlist2Data:this.state.playlist2Data,simularityScore:this.getSimilarityScore(),sources:this.state.sources})]})}}]),s}(l.a.Component),S=function(t){Object(o.a)(s,t);var e=Object(u.a)(s);function s(t){var a;return Object(i.a)(this,s),(a=e.call(this,t)).getAuthToken=function(){fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic "+p},body:"grant_type=client_credentials"}).then((function(t){return t.json()})).then((function(t){var e=new Date;e.setSeconds(e.getSeconds()+t.expires_in-60);var s={accessToken:t.access_token,validUntil:e.getTime()};localStorage.setItem("spotifyAccessToken",s.accessToken),localStorage.setItem("spotifyValidUntil",s.validUntil),a.setState(s)}),(function(t){return console.log(t)}))},a.refreshTokenIfNecessary=function(){if(null===localStorage.getItem("spotifyAccessToken")||Number(localStorage.getItem("spotifyValidUntil"))<=Date.now())return console.log("authorizing"),a.getAuthToken(),!0},a.setPlaylists=function(t,e){console.log("setting playlists"),a.setState({playlist1:t,playlist2:e})},a.state={accessToken:null,validUntil:null,fetchedPlaylists:!1,playlist1:null,playlist2:null},a}return Object(c.a)(s,[{key:"componentDidMount",value:function(){this.refreshTokenIfNecessary()||this.setState({accessToken:localStorage.getItem("spotifyAccessToken"),validUntil:Number(localStorage.getItem("spotifyValidUntil"))})}},{key:"render",value:function(){return console.log(this.state.accessToken),null!==this.state.playlist1&&null!==this.state.playlist2?Object(y.jsx)(b,{accessToken:this.state.accessToken,playlist1:this.state.playlist1,playlist2:this.state.playlist2,setPlaylists:this.setPlaylists,refreshTokenIfNecessary:this.refreshTokenIfNecessary}):Object(y.jsx)(d,{accessToken:this.state.accessToken,setPlaylists:this.setPlaylists,refreshTokenIfNecessary:this.refreshTokenIfNecessary})}}]),s}(l.a.Component);var v=function(){return Object(y.jsx)(S,{})},O=function(t){t&&t instanceof Function&&s.e(3).then(s.bind(null,27)).then((function(e){var s=e.getCLS,a=e.getFID,l=e.getFCP,n=e.getLCP,r=e.getTTFB;s(t),a(t),l(t),n(t),r(t)}))};r.a.render(Object(y.jsx)(l.a.StrictMode,{children:Object(y.jsx)(v,{})}),document.getElementById("root")),O()}},[[26,1,2]]]);
//# sourceMappingURL=main.8b5b733d.chunk.js.map